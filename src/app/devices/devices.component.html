<!-- Component title -->
<div class="row row-title mb-4">
    <div class="col-lg-5">
      <h2>Devices</h2>
    </div>
    <div class="col-lg-5">
      <div *ngIf="groupOne" class="close-group-button">
        <button class="button" (click)="openGroup()">
          <span>GROUP 1<span class="close-trigger">X</span></span>
        </button>
      </div>
    </div>
  </div>
  <div class="row row-info">
    <!-- Summary group info card -->
    <div *ngIf="!groupOne" class="col-lg-4 h-100">
      <div class="card h-100">
        <div class="card-title-c">
          <h5 class="text-uppercase">Summary</h5>
        </div>
        <div class="summary-card">
          <div>
            <div class="circle summary-box">
              <span class="align-self-center mt-1">4</span>
            </div>
            <p class="circle-name text-center text-uppercase mt-3">Groups</p>
          </div>
          <div>
            <div class="circle summary-box">
              <span class="align-self-center mt-1">10</span>
            </div>
            <p class="circle-name text-center text-uppercase mt-3">Devices</p>
          </div>
        </div>
      </div>
    </div>
    <!-- Summary group info card group 1 -->
    <div *ngIf="groupOne" class="col-lg-4 h-100">
      <div class="card h-100">
        <div class="card-title-c">
          <h5 class="text-uppercase">Summary Group 1</h5>
        </div>
        <div class="summary-card">
          <table class="table summary-devices-table">
            <tr>
              <th class="grey">
                Availability
              </th>
              <td class="summary-devices-availability">ENABLED</td>
            </tr>
            <tr>
              <th class="grey">
                API Key
              </th>
              <td 
                class="dark-grey" 
                tooltip= "API Key" 
                placement="bottom">
                7bd7d59cfe90e4d32b1d2f20d39c86df-fbaa8670-1008-ac7a-398a-3c11ac797c77
              </td> 
            </tr>
            <tr>
              <th class="grey">
                Devices
              </th>
              <td class="summary-devices-running">4</td>
            </tr>
          </table>
        </div>
      </div>
    </div>
    <!-- Devices status timeline info card -->
    <div *ngIf="!groupOne" class="col-lg-8 h-100">
      <div class="card p-4 h-100">
        <div class="card-title-c">
          <h5>DEVICES STATUS TIMELINE</h5>
        </div>
        <div 
          *ngIf="instances.length === 0" 
          class="h-100 d-flex justify-content-center align-items-center box-line-chart text-center"> 
          No devices deployed yet
        </div>
        <div *ngIf="instances.length>0" class="h-100 box-line-chart">
          <ngx-charts-line-chart
            [scheme]="colorScheme"
            [results]="appsChart"
            [xAxis]="showXAxis"
            [yAxis]="showYAxis"
            [gradient]="gradient" 
            [showXAxisLabel]="showXAxisLabel"
            [showYAxisLabel]="showYAxisLabel"
            [yScaleMin]="0"
            [yScaleMax]="100"
            [showGridLines]="showGridLines"
            [showRefLines]="showRefLines"
            [schemeType]="schemeType"
            [customColors]="customColors"
            [rangeFillOpacity]="rangeFillOpacity"
            [referenceLines]="referenceLines"
            [showRefLabels]="showRefLabels"
            >
          </ngx-charts-line-chart>
          <div class="y-axis-line-chart">
            <span class="grey">100%</span>
            <span class="grey mb-4">0%</span>
          </div>  
        </div>
      </div>
    </div>
    <!-- Devices status timeline info card group one -->
    <div *ngIf="groupOne" class="col-lg-8 h-100">
      <div class="card p-4 h-100">
        <div class="card-title-c">
          <h5>GROUP 1 DEVICES STATUS TIMELINE</h5>
        </div>
        <div 
          *ngIf="instances.length === 0" 
          class="h-100 d-flex justify-content-center align-items-center box-line-chart text-center"> 
          No devices deployed yet
        </div>
        <div *ngIf="instances.length>0" class="h-100 box-line-chart">
          <ngx-charts-line-chart
            [scheme]="colorScheme"
            [results]="appsChart"
            [xAxis]="showXAxis"
            [yAxis]="showYAxis"
            [gradient]="gradient" 
            [showXAxisLabel]="showXAxisLabel"
            [showYAxisLabel]="showYAxisLabel"
            [yScaleMin]="0"
            [yScaleMax]="100"
            [showGridLines]="showGridLines"
            [showRefLines]="showRefLines"
            [schemeType]="schemeType"
            [customColors]="customColors"
            [rangeFillOpacity]="rangeFillOpacity"
            [referenceLines]="referenceLines"
            [showRefLabels]="showRefLabels"
            >
          </ngx-charts-line-chart>
          <div class="y-axis-line-chart">
            <span class="grey">100%</span>
            <span class="grey mb-4">0%</span>
          </div>  
        </div>
      </div>
    </div>
  </div>
  <!-- Deployed devices list panel card-->
  <div class="row row-main">
    <div class="col-lg-12 col-md-12 col-sm-12 h-100">
      <div class="card h-100 p-4">
        <div class="card-title-h">
          <h5>DEVICES</h5>
        </div>
        <!-- Devices tabs -->
        <div class="devices-tab-container">
          <ul>
            <li class="devices-tab devices-tab-title">
              <span class="grey">GROUPS</span>
            </li>
            <li class="devices-tab">
              <span [ngClass]="{active: !groupOne}" >ALL</span>
            </li>
            <li 
              class="devices-tab"
              (click)="openGroup()">
              <span [ngClass]="{active: groupOne}">GROUP 1</span>
            </li>
            <li class="devices-tab">
              <span>GROUP 2</span>
            </li>
            <ul *ngIf="!groupOne" class="devices-tab-button">
              <li>
                <span class="devices-button-item blue devices-button-item-pr" (click)="addUser()">
                  <i class="material-icons">add</i>
                  ADD GROUP 
                </span>
              </li>
            </ul>
            <ul *ngIf="groupOne" class="devices-tab-button">
              <li>
                <span class="devices-button-item blue" (click)="addUser()">
                  <i class="material-icons">add</i>
                  ADD GROUP 
                </span>
              </li>
              <li>
                <span class="devices-button-item">
                  <i class="material-icons">delete</i>
                  DELETE GROUP
                </span>
              </li>
              <li>
                <span 
                  (click)="openGroupConfiguration()" 
                  class="devices-button-item devices-button-item-pr">
                  <i class="material-icons">settings</i>
                  CONFIGURATION
                </span>
              </li>
            </ul>
          </ul>
        </div>       
         <!-- // end Devices tabs -->
        <div class="row justify-content-between">
          <!-- Sorting mesages -->
          <div class="col-9">  
            <p *ngIf="searchTerm && !filterField" class="sorting-message">
              Filtered by term "{{ searchTerm }}".
              <span class="blue reset-search" (click)="resetFilters(filterField)">Reset</span>
            </p>
            <p *ngIf="filterField && !searchTerm" class="sorting-message">
              Sorted by {{ sortedBy }},
              <span *ngIf="reverse">ascendant. </span>
              <span *ngIf="!reverse">descendant. </span>
              <span class="blue reset-search" (click)="resetFilters(filterField)">Reset</span>
            </p>
            <p *ngIf="filterField && searchTerm" class="sorting-message">
              Sorted by {{ sortedBy }}
              <span *ngIf="reverse">ascendant </span>
              <span *ngIf="!reverse">descendant </span>
              and filtered by term "{{ searchTerm }}".
              <span class="blue reset-search" (click)="resetFilters(filterField)">Reset</span>
            </p> 
          </div>
          <!-- Search input -->
          <div class="col-3">
            <form>
              <div class="search-box">
                <input 
                  type="text" 
                  class="form-control" 
                  name="searchTerm" 
                  placeholder="Search..." 
                  [(ngModel)]="searchTerm"> 
                  <div class="search-icon" *ngIf="searchTerm === ''">
                    <i class="material-icons">search</i>
                  </div>     
                  <div class="close-icon" *ngIf="searchTerm !== ''">
                    <i class="material-icons" (click)="resetFilters(filterField)">close</i>
                  </div>
              </div>
            </form>
          </div>      
        </div>
        <!-- Devices table -->
        <div class="table-h" *ngIf="loadedData && instances && instances.length > 0 && !requestError" >
          <table class="table-responsive table-fixed">
            <thead>
              <tr>
                <th 
                  (click)="setOrder('id')"
                  [ngClass]="getCategoryCSSClass('id')"
                  scope="col" 
                  class="col-2">
                  ID
                  <span class="expand-chevron" *ngIf="sortedBy === 'id' && !reverse">
                    <i class="material-icons">expand_more</i>
                  </span>
                  <span class="expand-chevron" *ngIf="sortedBy === 'id' && reverse">
                    <i class="material-icons">expand_less</i>
                  </span>
                </th>
                <th 
                  (click)="setOrder('registeredDate')" 
                  [ngClass]="getCategoryCSSClass('registeredDate')"
                  scope="col" 
                  class="col-2">
                  Date registered
                  <span class="expand-chevron" *ngIf="sortedBy === 'registeredDate' && !reverse">
                    <i class="material-icons">expand_more</i>
                  </span>
                  <span class="expand-chevron" *ngIf="sortedBy === 'registeredDate' && reverse">
                    <i class="material-icons">expand_less</i>
                  </span>
                </th>
                <th 
                  (click)="setOrder('status')" 
                  [ngClass]="getCategoryCSSClass('status')"
                  scope="col" 
                  class="col-2 text-center">
                  Status
                  <span class="expand-chevron" *ngIf="sortedBy === 'status' && !reverse">
                    <i class="material-icons">expand_more</i>
                  </span>
                  <span class="expand-chevron" *ngIf="sortedBy === 'status' && reverse">
                    <i class="material-icons">expand_less</i>
                  </span>
                </th> 
                <th 
                  (click)="setOrder('labels')" 
                  [ngClass]="getCategoryCSSClass('labels')"
                  scope="col" 
                  class="col-5">
                  Labels
                  <span class="expand-chevron" *ngIf="sortedBy === 'labels' && !reverse">
                    <i class="material-icons">expand_more</i>
                  </span>
                  <span class="expand-chevron" *ngIf="sortedBy === 'labels' && reverse">
                    <i class="material-icons">expand_less</i>
                  </span>
                </th>
                <th scope="col" class="col-1 text-center">
                  Enabled
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let app of instances | sortBy : sortedBy : reverse : 'case-insensitive' | filter : searchTerm">
                <td class="col-2">{{app.app_instance_id}}</td>
                <td class="col-2">{{app.description}}</td>  
                <td 
                  class="text-lowercase col-2 text-center"
                  [ngClass]=
                  "{'status-dot':classStatusCheck(app.status_name, 'running'),
                  'status-dot-error':classStatusCheck(app.status_name, 'error'),
                  'status-dot-process':classStatusCheck(app.status_name, 'process')}"> 
                  <span 
                    tooltip="{{app.status_name | lowercase}}" 
                    class="tooltip-fix" 
                    placement="auto">
                  </span>
                  <span class="hide">
                    {{app.status_name}}
                  </span>
                </td>
                <td class="col-5">
                  <button 
                    *ngFor="let label of labelsToString(app.labels)" 
                    class="btn-sm btn-outline-primary" 
                    disabled>
                    {{label[0]}}: {{label[1]}}
                  </button>
                </td>
                <td class="row-info-btn col-1 text-center">
                  <span 
                    *ngIf="!checkBox" 
                    (click)="enabled()">
                    <i class="material-icons grey">check_box_outline_blank</i>
                  </span>
                  <span 
                    *ngIf="checkBox"  
                    (click)="enabled()" 
                    class="devices-checkbox">
                    <i class="material-icons blue">check_box</i>
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
         <!-- No info to show -->
        <div 
          *ngIf="loadedData && instances && instances.length === 0 && !requestError"
          class="no-apps d-flex justify-content-center align-items-center">
          No available applications detected
        </div>
         <!-- Requested error -->
        <div
          *ngIf="loadedData && requestError"
          class="no-elements d-flex justify-content-center align-items-center">
          <p>{{ requestError }}</p>
        </div>
        <!-- Loader -->
        <div class="nalej-loader-container" *ngIf="!loadedData">
          <div class="loader">
            <svg 
              class="circular" 
              viewBox="25 25 50 50">
              <circle 
                class="path" 
                cx="50" 
                cy="50" 
                r="20" 
                fill="none" 
                stroke-width="2" 
                stroke-miterlimit="10"/>
            </svg>
          </div>
        </div>
      </div>
    </div>
  </div>