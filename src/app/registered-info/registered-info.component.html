<!-- Component title -->
<div class="row row-title">
  <div class="col-lg-12">
    <h2 class="section-title">{{'apps.instance.title'|translate}}</h2>
  </div>
</div>
<div class="row row-app-main">
  <div class="col-4 h-100">
    <div class="flex-col-app">
      <!-- Registered application id card -->
      <div class="card row-info-app flex-grow-0">
        <div class="card-title-name">
          <h5>
            <a 
              [routerLink]="['/applications']" 
              routerLinkActive="active" 
              class="blue">
              {{'apps.instance.idApps'|translate}}
            </a>
            <span class="grey"> > </span>
            <b>{{'apps.instance.idRegistered'|translate}}</b>
            <span class="grey"> > </span>
            <span class="grey text-uppercase">
            {{registeredData.name}}
            </span>
          </h5>
        </div>
        <div class="reg-info-box">
          <div class="reg-info-id-box">
            <div class="reg-info mx-2">
              <p class="reg-info-id text-left">{{'apps.instance.tableId'|translate}}</p>
              <p class="reg-info-id w-75">{{registeredData.app_descriptor_id}}</p>
            </div>
          </div>
          <div class="reg-info">
            <button (click)="deployRegistered(registeredData)" class="reg-deploy">
              <i class="material-icons i-options">play_arrow</i>
              {{'apps.registered.deploy'|translate}} <span class="hide-reg-btn-text">{{'apps.registered.instance'|translate}}</span> 
            </button>
            <button (click)="deleteApp(registeredData)" class="reg-undeploy">
              <i class="material-icons i-options">delete</i>
              {{'apps.registered.delete'|translate}} <span class="hide-reg-btn-text">{{'apps.registered.app'|translate}}</span>
            </button>
          </div>
        </div>
      </div>
      <!-- Services summary card -->
      <div class="card row-summary-app flex-grow-0">
        <div class="card-title-name">
          <h5>{{'apps.registered.servicesSummary'|translate}}</h5>
        </div>
        <div *ngIf="registeredData.groups && registeredData.groups.length > 0" class="summary-card">
          <div class="summary-box">
            <div class="circle">
              <span>{{registeredData.groups.length}}</span>
            </div>
            <p class="circle-name">{{'devices.summary.groups.title'|translate}}</p>
          </div>
          <div class="summary-box">
            <div class="circle">
              <span>{{getServicesCount(registeredData)}}</span>
            </div>
            <p class="circle-name">{{'apps.instance.servicesTitle'|translate}}</p>
          </div>
        </div>
        <div *ngIf="!registeredData.groups || registeredData.groups.length === 0" class="no-elements">
          {{'apps.registered.noRegisteredApps'|translate}}
        </div>
      </div>
      <!-- Labels card-->
      <labels-card *ngIf="loadedData"
        [labelsData]="registeredData"
        [isSelectableLabel]="isSelectableLabel"
        (updateLabels)="updateLabels($event)"
        class="row-info-app">
      </labels-card>
      <!-- Action buttons card -->
      <action-buttons-card *ngIf="loadedData"
        [app]="registeredData"
        [isOpenFromRegistered]="isOpenFromRegistered">
      </action-buttons-card>
    </div>
  </div>
  <!-- Services card-->
  <div class="col-8 h-100">
    <div class="flex-col-app">
      <div class="card">
        <services-card (displayGraph)="onShowGraph($event)">     
        </services-card>

              <!-- Search box -->
              <div *ngIf="
                registeredData &&
                registeredData.groups &&
                registeredData.groups.length > 0" 
                class="row mb-3">
                <!-- Sorting messages -->
                <div class="col-7">
                  <p *ngIf="searchTerm && !filterField" class="sorting-message">
                    {{'sortingMessage.filteredBy'|translate:{value: searchTerm} }}
                    <span (click)="resetFilters('services')" class="reset-search">
                      {{'sortingMessage.reset'|translate}}
                    </span>
                  </p>
                  <p *ngIf="filterField && !searchTerm" class="sorting-message">
                    {{'sortingMessage.sortedBy'|translate:{value: sortedBy} }},
                    <span *ngIf="reverse">{{'sortingMessage.ascendant'|translate:{value: '. '} }} </span>
                    <span *ngIf="!reverse">{{'sortingMessage.descendant'|translate:{value: '. '} }} </span>
                    <span (click)="resetFilters('services')" class="reset-search">
                      {{'sortingMessage.reset'|translate}}
                    </span>
                  </p>
                  <p *ngIf="filterField && searchTerm" class="sorting-message">
                    {{'sortingMessage.sortedBy'|translate:{value: sortedBy} }},
                    <span *ngIf="reverse">{{'sortingMessage.ascendant'|translate:{value: ' '} }} </span>
                    <span *ngIf="!reverse">{{'sortingMessage.descendant'|translate:{value: ' '} }} </span>
                    {{'sortingMessage.andFilteredBy'|translate:{value: searchTerm} }}.
                    <span (click)="resetFilters('services')" class="reset-search">
                    {{'sortingMessage.reset'|translate}}
                    </span>
                  </p>
                </div>
                <!-- Search input -->
                <div class="col-5">
                  <form>
                    <div class="search-box">
                      <input 
                        name="searchTerm" 
                        [(ngModel)]="searchTerm"
                        type="text" 
                        placeholder="{{'searcher.placeholder'|translate }}"
                        class="form-control"> 
                        <div *ngIf="searchTerm === ''" class="search-icon">
                          <i class="material-icons">search</i>
                        </div>     
                        <div *ngIf="searchTerm !== ''" class="close-icon">
                          <i (click)="resetFilters(filterField)" class="material-icons">close</i>
                        </div>
                    </div>
                  </form>
                </div>
              </div>
              <!--  Services tab -->
              <div class="row h-100">
                <div class="col accordion-box">
                  <accordion 
                    *ngFor="let group of groups"
                    class="accordion-tabs">
                    <accordion-group 
                      *ngIf="groups.length > 0"
                      heading="{{group.name}}"
                      [panelClass]="nalejAccordion"
                      [isOpen]="group.isFirstOpen">
                      <span     
                        accordion-heading 
                        class="accordion-icons-box">
                        <i class="material-icons accordion-arrow">arrow_drop_down</i>
                        <div class="accordion-btn">
                          <div    
                            (click)="openRegisteredServicesGroupInfo(group, $event)" 
                            tooltip="{{'apps.instance.tableInfo'|translate}}" 
                            placement="left">
                            <i class="material-icons info-icon">info</i>
                          </div>
                        </div>
                      </span>
                      <!-- No services to show -->
                      <div *ngIf="countGroupServices() === 0" class="no-elements-in-group">
                        {{'apps.instance.noServicesInGroup'|translate}}
                      </div>
                      <!-- Services table -->
                      <div *ngIf=
                        "loadedData &&
                        registeredData.groups &&
                        registeredData.groups.length > 0 &&
                        !requestError"
                        class="nalej-table-box no-p-col no-m-row">
                        <div class="label-nalej-table">
                          <div *ngIf="!searchTerm" class="label-thead row">
                            <div class="col-12">
                              <div class="row">
                                <div 
                                  (click)="setOrder('services','name')"
                                  [ngClass]="getCategoryCSSClass('services','name')"
                                  class="label-th col-5">
                                    {{'apps.instance.tableName'|translate}}
                                  <span *ngIf="sortedBy === 'name' && !reverse" class="expand-chevron">
                                    <i class="material-icons">expand_more</i>
                                  </span>
                                  <span *ngIf="sortedBy === 'name' && reverse" class="expand-chevron">
                                    <i class="material-icons">expand_less</i>
                                  </span>
                                </div>
                                <div 
                                  (click)="setOrder('services','image')"   
                                  [ngClass]="getCategoryCSSClass('services','image')"
                                  class="label-th col-6">
                                    {{'apps.instance.tableImage'|translate}}
                                  <span *ngIf="sortedBy === 'image' && !reverse" class="expand-chevron">
                                    <i class="material-icons">expand_more</i>
                                  </span>
                                  <span *ngIf="sortedBy === 'image' && reverse" class="expand-chevron">
                                    <i class="material-icons">expand_less</i>
                                  </span>
                                </div>
                                <div class="label-th col-1 text-center">
                                  {{'apps.instance.tableInfo'|translate}}
                                </div>
                            </div>
                            </div>
                            <div  
                              (click)="setOrder('services','labels')" 
                              [ngClass]="getCategoryCSSClass('services','labels')" 
                              class="label-th col-12">
                                {{'apps.instance.tableLabels'|translate}}
                              <span *ngIf="sortedBy === 'labels' && !reverse" class="expand-chevron">
                                <i class="material-icons">expand_more</i>
                              </span>
                              <span *ngIf="sortedBy === 'labels' && reverse" class="expand-chevron">
                                <i class="material-icons">expand_less</i>
                              </span>
                            </div>
                          </div>
                          <div *ngFor=
                            "let service of getGroupServices(group.service_group_id) |
                            sortBy : sortedBy : reverse : 'case-insensitive' |
                            filter : searchTerm">
                            <div class="label-tbody row">
                              <div class="col-12">
                                <div class="row">
                                  <div class="col-5 label-td"> 
                                      {{service.name}}
                                    </div>
                                    <div class="col-6 label-td">
                                      {{service.image}}
                                    </div>
                                    <div class="col-1 label-td-flex text-center">
                                      <div    
                                        (click)="openServicesInfo(service)" 
                                        tooltip="{{'apps.instance.tableInfo'|translate}}" 
                                        placement="left">
                                        <i class="material-icons info-icon">info</i>
                                      </div>
                                    </div>
                                </div>
                              </div>
                              <div class="col-12 label-td">
                                <button 
                                  *ngFor="let label of service.labels | keyvalue"
                                  class="label-content-disabled"> 
                                  {{label.key}}: {{label.value}}
                                </button>
                              </div>
                              <hr class="accordion-table-separator">
                            </div>
                          </div>
                        </div>
                      </div>
                      <!-- No info to show -->
                      <div *ngIf=
                      "loadedData &&
                      !requestError &&
                      registeredData.groups.length === 0" 
                      class="no-elements">
                      {{'apps.instance.noServices'|translate}}
                    </div>
                    <!-- Requested error -->
                    <div *ngIf="loadedData && requestError" class="no-elements">
                      <p>{{ requestError }}</p>
                    </div>
                  </accordion-group>
                </accordion>
                </div>
              </div>
              <!-- Loader -->
              <div *ngIf="!loadedData" class="nalej-loader-box">
                <div class="loader">
                  <svg class="circular" viewBox="25 25 50 50">
                    <circle 
                      class="path" 
                      cx="50" 
                      cy="50" 
                      r="20" 
                      fill="none" 
                      stroke-width="2" 
                      stroke-miterlimit="10" />
                  </svg>
                </div>
              </div>



      </div>
    </div>
  </div>
</div>




